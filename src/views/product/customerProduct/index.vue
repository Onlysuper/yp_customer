<template>
  <!-- 商户管理 -->
  <div class="admin-page">
    <div class="admin-main-box">
      <!-- search form start -->
      <myp-search-form @changeform="callbackformHandle" @resetInput="resetSearchHandle" @visiblesome="visiblesomeHandle" @changeSearchVisible="changeSearchVisible" @seachstart="seachstartHandle" :searchOptions="searchOptions"></myp-search-form>
      <!-- search form end -->
      <myp-data-page @pagecount="pagecountHandle" @pagelimit="pagelimitHandle" @operation="operationHandle" ref="dataTable" :tableDataInit="tableData" :page="postPage" :limit="postLimit" :search="postSearch"></myp-data-page>
    </div>
    <!-- <full-shade></full-shade> -->
    <!-- 商户状态 start -->
    <el-dialog class="special-dialog" title="商户状态" center :visible.sync="detailsFormVisible" id="dialogLoding">
      <div class="detail-content">
        <template>
          <!-- 聚合详情 -->
          <div class="detail-body">
            <div class="detaile-left">
              <iscroll-view class="scroll-view-cus " ref="iscroll" :options="iscrollOptions">
                <div class="line-box-left">
                  <el-select size="small" v-model="selectOptions.customerType" placeholder="请选择">
                    <el-option v-for="item in selectOptions.customerTypeOptions" :key="item.value" :label="item.label" :value="item.value" :disabled="item.disabled">
                    </el-option>
                  </el-select>
                </div>

                <template v-if="payStatusVisible">
                  <div class="line-label-box">
                    <span class="line-label">商户编号:</span>
                    <span class="line-label-last">{{detailsForm.bussinessNo}}</span>
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">商户名称:</span>
                    <span class="line-label-last">{{detailsForm.customerName}}</span>
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">聚合状态:</span>{{detailsForm.payStatus | handleProductOpenStatus}}
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">企业名称:</span>
                    <span class="line-label-last">{{payStatusDetails.enterpriseName}}</span>
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">企业税号:</span>
                    <span class="line-label-last">{{payStatusDetails.taxNo}}</span>
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">营业执照期限:</span>
                    <span class="line-label-last">{{payStatusDetails.bussinessLicenseEffectiveBegin}} - {{payStatusDetails.bussinessLicenseEffectiveEnd}}</span>
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">所在地区:</span>{{payStatusDetails.orgCode?utils.findCity(payStatusDetails.orgCode).resultAddr:""}}
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">详细地址:</span>{{payStatusDetails.bussinessAddress}}
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">法人:</span>{{payStatusDetails.legalPerson}}
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">身份证号:</span>{{payStatusDetails.idCard}}
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">行业类型:</span>{{payStatusDetails.category?utils.findBussinessType(payStatusDetails.category).name:""}}
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">账户类型:</span>{{payStatusDetails.accountType | accountType}}
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">账户名称:</span>{{payStatusDetails.accountName||""}}
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">开户银行:</span>{{payStatusDetails.bankName||""}}
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">开户支行:</span>{{payStatusDetails.branchName||""}}
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">账号:</span>{{payStatusDetails.accountNo||""}}
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">微信费率:</span>{{utils.accMul(payStatusDetails.wechatRate,100)+'%' ||""}}
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">支付宝费率:</span>{{utils.accMul(payStatusDetails.alipayRate,100)+'%'||""}}
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">开通即刷即到:</span>{{payStatusDetails.settleMode | settleMode}}
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">D0手续费:</span>{{payStatusDetails.t0CashCostFixed||""}}
                  </div>
                </template>
                <template v-if="qrcodeStatusVisible">
                  <div class="line-label-box">
                    <span class="line-label">商户编号:</span>
                    <span class="line-label-last">{{detailsForm.bussinessNo}}</span>
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">商户名称:</span>
                    <span class="line-label-last">{{detailsForm.customerName}}</span>
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">快速开票:</span>{{detailsForm.qrcodeStatus | handleProductOpenStatus}}
                  </div>
                </template>
                <template v-if="elecStatusVisible">
                  <!-- 电子详情 -->
                  <div class="line-label-box">
                    <span class="line-label">商户编号:</span>
                    <span class="line-label-last">{{detailsForm.bussinessNo}}</span>
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">商户名称:</span>
                    <span class="line-label-last">{{detailsForm.customerName}}</span>
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">开通状态:</span>{{detailsForm.elecStatus | handleProductOpenStatus}}
                  </div>
                  <!-- 电子发票查询详情 -->
                  <div class="line-label-box">
                    <span class="line-label">注册省份:</span>
                    <span class="line-label-last">
                      {{elecStatusDetails.orgCode?utils.findCity(elecStatusDetails.orgCode).resultAddr:""}}
                    </span>
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">注册地址:</span>
                    <span class="line-label-last">{{elecStatusDetails.bussinessAddress}}</span>
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">联系电话:</span>
                    <span class="line-label-last">{{elecStatusDetails.bussinessPhone}}</span>
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">经营名称:</span>
                    <span class="line-label-last">{{elecStatusDetails.bussinessName}}</span>
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">注册资金:</span>
                    <span class="line-label-last">{{elecStatusDetails.registMoney}}</span>
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">开户银行:</span>
                    <span class="line-label-last">{{elecStatusDetails.branchName}}</span>
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">银行账号:</span>
                    <span class="line-label-last">{{elecStatusDetails.bankAccountNo}}</span>
                  </div>
                  <div class="line-label-box">
                    <span class="line-label">月开票量:</span>
                    <span class="line-label-last">{{elecStatusDetails.elecBillnum}}</span>
                  </div>
                  <div class="line-label-box" v-if="elecStatusDetails.elecReason==''||elecStatusDetails.elecReason==null?false:true">
                    <span class="line-label">被拒原因:</span>
                    <span class="line-label-last">{{elecStatusDetails.elecReason}}</span>
                  </div>
                </template>
              </iscroll-view>
            </div>
            <template v-if="payStatusVisible">
              <div class="detaile-right">
                <scroll-pane class='tags-view-wrapper' ref='scrollPane'>
                  <div class="small-but pre" @click="preFn" slot="preBut">《</div>
                  <div class="small-but next" @click="preNext" slot="nextBut">》</div>
                  <div class="imgs-group">
                    <div class="img-box">
                      <p class="img-title">法人身份证正面:</p>
                      <div class="img-back">
                        <img @click="showImg(payStatusDetails.identityFrontImg.url||'','pay')" class="img-size" :src="payStatusDetails.identityFrontImg.url||''" alt="">
                      </div>
                    </div>
                    <div class="img-box">
                      <p class="img-title">法人身份证反面:</p>
                      <div class="img-back">
                        <img @click="showImg(payStatusDetails.identityBackImg.url||'','pay')" class="img-size" :src="payStatusDetails.identityBackImg.url||''" alt="">
                      </div>
                    </div>
                    <div class="img-box">
                      <p class="img-title">营业执照:</p>
                      <div class="img-back">
                        <img @click="showImg(payStatusDetails.bussinessLicenseImg.url||'','pay')" class="img-size" :src="payStatusDetails.bussinessLicenseImg.url||''" alt="">
                      </div>
                    </div>
                    <div class="img-box">
                      <p class="img-title">手持身份证:</p>
                      <div class="img-back">
                        <img @click="showImg(payStatusDetails.identityHolderImg.url||'','pay')" class="img-size" :src="payStatusDetails.identityHolderImg.url||''" alt="">
                      </div>
                    </div>
                    <div class="img-box">
                      <p class="img-title">结算卡正面:</p>
                      <div class="img-back">
                        <img @click="showImg(payStatusDetails.settleCardImg.url||'','pay')" class="img-size" :src="payStatusDetails.settleCardImg.url||''" alt="">
                      </div>
                    </div>
                    <div class="img-box">
                      <p class="img-title">开户许可证:</p>
                      <div class="img-back">
                        <img @click="showImg(payStatusDetails.accountLicenseImg.url||'','pay')" class="img-size" :src="payStatusDetails.accountLicenseImg.url||''" alt="">
                      </div>
                    </div>
                    <div class="img-box">
                      <p class="img-title">门头照片:</p>
                      <div class="img-back">
                        <img @click="showImg(payStatusDetails.placeImg.url||'','pay')" class="img-size" :src="payStatusDetails.placeImg.url||''" alt="">
                      </div>
                    </div>
                    <div class="img-box">
                      <p class="img-title">店内照片:</p>
                      <div class="img-back">
                        <img @click="showImg(payStatusDetails.storeImg.url||'','pay')" class="img-size" :src="payStatusDetails.storeImg.url||''" alt="">
                      </div>
                    </div>
                    <div class="img-box">
                      <p class="img-title">收银台照片:</p>
                      <div class="img-back">
                        <img @click="showImg(payStatusDetails.cashSpaceImg.url||'','pay')" class="img-size" :src="payStatusDetails.cashSpaceImg.url||''" alt="">
                      </div>
                    </div>
                  </div>
                </scroll-pane>
                <div class="large-img">
                  <img @click="largeImageShow(largeImgUrl,'payStatus')" class="img-large" :src="largeImgUrl" alt="">
                </div>
              </div>
            </template>
            <template v-if="qrcodeStatusVisible">
              <div class="detaile-right">
                <scroll-pane class='tags-view-wrapper' ref='scrollPane'>
                  <div class="imgs-group">
                    <div class="img-box">
                      <p class="img-title">营业执照:</p>
                      <div class="img-back">
                        <img @click="showImg(qrcodeImgs.fastBussinessImg.url||'','qrcode')" class="img-size" :src="qrcodeImgs.fastBussinessImg.url||''" alt="">
                      </div>
                    </div>
                    <div class="img-box">
                      <p class="img-title">收银台照片:</p>
                      <div class="img-back">
                        <img @click="showImg(qrcodeImgs.fastCashImg.url||'','qrcode')" class="img-size" :src="qrcodeImgs.fastCashImg.url||''" alt="">
                      </div>
                    </div>
                    <div class="img-box">
                      <p class="img-title">门头照片:</p>
                      <div class="img-back">
                        <img @click="showImg(qrcodeImgs.fastHeaderImg.url||'','qrcode')" class="img-size" :src="qrcodeImgs.fastHeaderImg.url||''" alt="">
                      </div>
                    </div>
                  </div>
                </scroll-pane>
                <div class="large-img">
                  <img @click="largeImageShow(qrcodelargeImgUrl,'qrcode')" class="img-large" :src="qrcodelargeImgUrl" alt="">
                </div>
              </div>
            </template>
          </div>
        </template>

      </div>
      <div slot="footer" class="dialog-footer">
        <!-- <el-button @click="detailsFormVisible = false">取 消</el-button> -->
        <!-- <el-button v-if="editVisiblebut" :disabled="deitDisabled_edit(selectOptions.customerType,detailsForm)" type="primary" @click="editFn()">编辑</el-button> -->
        <el-button v-if="editVisiblebut" type="primary" @click="editFn()">编辑</el-button>
        <el-button v-if="checkVisiblebut" type="primary" @click="adoptSave(selectOptions.customerType,detailsForm)">审核通过</el-button>
        <el-button v-if="checkVisiblebut" type="primary" @click="refuseSave(selectOptions.customerType,detailsForm)">审核拒绝</el-button>
      </div>
    </el-dialog>
    <!-- 详情 end -->
    <!-- 开通产品 start -->
    <el-dialog :title="productOpenTitle" center :visible.sync="editFormVisible">
      <!-- <keep-alive> -->
      <component v-on:titleChange="titleChange" v-on:nextFn="nextFn" v-on:backFn="backFn" v-bind:is="currentView" :customerTypeSelected="customerTypeSelected" :rowData="resaultData">
        <!-- 组件在 vm.currentview 变化时改变！ -->
      </component>
      <!-- </keep-alive> -->
    </el-dialog>
    <!-- 开通产品 end -->
    <!-- 关闭start -->
    <el-dialog title="关闭" center :visible.sync="closeVisible">
      <div class="line-box-center">
        <el-select size="small" v-model="selectOptions.customerType" placeholder="请选择">
          <el-option v-for="item in selectOptions.customerTypeOptions" :key="item.value" :label="item.label" :value="item.value" :disabled="item.disabled">
          </el-option>
        </el-select>
      </div>
      <el-form size="small" :model="closeForm" ref="closeForm" :rules="closeFormRules" label-width="100px">
        <el-form-item prop="reason" label="关闭原因">
          <el-input type="textarea" v-model="closeForm.reason"></el-input>
        </el-form-item>
      </el-form>
      <div slot="footer" class="dialog-footer">
        <el-button @click="closeVisible = false">取 消</el-button>
        <el-button type="primary" @click="closeSave('closeForm')">确定</el-button>
      </div>
    </el-dialog>
    <!-- 关闭end -->
    <el-dialog title="" center :visible.sync="styleVisible">
      <el-form size="small" :model="styleForm" ref="styleForm" :rules="styleFormRules" label-width="100px">
        <el-form-item label="开票类型:" prop="supportTypes" :label-width="formLabelWidth">
          <el-checkbox-group v-model="styleForm.supportTypes">
            <el-checkbox v-for="item in supportTypesOptions" :label="item.code" :key="item.code">{{item.name}}</el-checkbox>
          </el-checkbox-group>
        </el-form-item>
        <el-form-item label="支付类型:" prop="payTypes" :label-width="formLabelWidth">
          <el-checkbox-group v-model="styleForm.payTypes">
            <el-checkbox v-for="item in payTypesOptions" :label="item.code" :key="item.code">{{item.name}}</el-checkbox>
          </el-checkbox-group>
        </el-form-item>
      </el-form>
      <div slot="footer" class="dialog-footer">
        <el-button @click="styleVisible = false">取 消</el-button>
        <el-button type="primary" @click="styleFormSave('styleForm')">确定</el-button>
      </div>

    </el-dialog>
    <transition name="slide-fade" class="fadeView">
      <div v-if="fadeViewVisible">
        <image-view :imgArr="largeUrl" :showImageView="true" :imageIndex="0" v-on:hideImage="hideImageView"></image-view>
      </div>
    </transition>

  </div>
</template>
<!-- Add "scoped" attribute to limit CSS to this component only -->
<style lang='scss'>
@media screen and (min-width: 500px) {
  .scroll-view-cus {
    touch-action: none;
    /* -- Attention-- */
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    overflow: hidden;
  }
  .admin-page {
    .small-but {
      position: absolute;
      // width: 30px;
      // height: 30px;
      padding: 0 5px;
      text-align: center;
      line-height: 30px;
      background: rgba(0, 0, 0, 0.3);
      z-index: 10;
      top: 40px;
      color: #fff;
      cursor: pointer;
      &.next {
        right: 0;
      }
      &.pre {
        left: 0;
      }
    }
    .imageBox li {
      text-align: center;
    }
    .special-dialog {
      // overflow: hidden;
      margin-top: -5vw;
      // .el-dialog__header {
      //   display: none;
      // }
      .el-dialog {
        width: 90% !important;
      }
      .el-dialog__footer {
        padding: 0;
        .el-button {
          margin: 10px;
        }
      }
      .el-dialog__body {
        padding-bottom: 0px !important;
        // height: 500px;
      }
      .detail-content {
        height: 100%;
        overflow: auto;
        position: relative;
      }
      .detail-body {
        // height: 100%;
        // overflow-y: auto;
        height: 550px;
        overflow-x: hidden;
        display: flex;
        flex-direction: row;
        justify-content: flex-start;
        align-items: stretch;

        .detaile-left {
          margin-left: 10px;
          // overflow-y: auto;
          // min-width: 300px;
          // flex-basis: 300px;
          flex: 4;
          flex-shrink: 0;
          position: relative;
          // background: blue;
        }
        .detaile-right {
          flex: 6;
          display: flex;
          flex-direction: column;
          border-left: 1px solid #ebeef5;
          .tags-view-wrapper {
            // background: red;
            flex-shrink: 0;
            border-bottom: 1px solid #ebeef5;
            flex-basis: 100px;
            .imgs-group {
              width: 100%;
              display: flex;
              flex-direction: row;
              // padding: 5px;
              .img-box {
                margin: 5px;
                width: 90px;
                height: 90px;
                display: flex;
                flex-direction: column;
                overflow: hidden;
                align-items: stretch;
                .img-title {
                  width: 100%;
                  flex-basis: 20px;
                  line-height: 20px;
                  font-size: 10px;
                }
                .img-back {
                  border: 1px solid #ebeef5;
                  width: 100%;
                  height: 70px;
                  // flex: 1;
                  box-sizing: border-box;
                  img {
                    cursor: pointer;
                    width: 100%;
                    height: 100%;
                    &:hover {
                      opacity: 0.5;
                    }
                  }
                }
              }
            }
          }
          .large-img {
            text-align: center;
            flex: 1;
            padding: 10px;
            overflow: hidden;
            &:after {
              content: " ";
              display: inline-block;
              vertical-align: middle;
              height: 100%;
            }
            img {
              display: inline-block;
              vertical-align: middle;
              max-width: 100%;
              min-width: 300px;
              max-height: 100%;
              // height: 100%;
            }
          }
        }
      }
    }
  }
}
</style>
<script> 
import Vue from "vue";
import IScrollView from "vue-iscroll-view";
import IScroll from "iscroll";
Vue.use(IScrollView, IScroll);
import imageView from 'vue-imageview'
import ScrollPane from "@src/components/ScrollPane";
import FullShade from "@src/components/FullShade";
import SearchForm from "@src/components/SearchForm";
import DataPage from "@src/components/DataPage";
import { mixinsPc } from "@src/common/mixinsPc";
// table页与搜索页公用功能
import { mixinDataTable } from "@src/components/DataPage/dataPage";
import { todayDate } from "@src/common/dateSerialize";
import { taxNumVerify, idCardVerify, phoneNumVerify } from "@src/common/regexp";
import { regionData } from "element-china-area-data";
import utils from "@src/common/utils";
import openInfo from "./openInfo";
import paystatusGoods from "./paystatusGoods";
import paystatusUpload from "./paystatusUpload";
import paystatusSuccess from "./paystatusSuccess";
import {
  getCustomerOpenProducts,
  postCustomerOpenProductSearch,
  getCustomerEchoProduct,
  postHandleCustomerProduct,
  getQueryCustomerElectronic,
  getUserProductStatus
} from "@src/apis";

export default {
  name: "customerProduct",
  components: {
    "myp-search-form": SearchForm, // 搜索组件
    "myp-data-page": DataPage, // 数据列表组件
    openInfo: openInfo,
    paystatusGoods: paystatusGoods,
    paystatusUpload: paystatusUpload,
    paystatusSuccess: paystatusSuccess,
    openInfo: openInfo,
    FullShade,
    ScrollPane,
    ImageView: imageView
  },
  mixins: [mixinsPc, mixinDataTable],
  data() {
    var user = this.$store.state.userInfoAndMenu.userMessage.all;
    var isAdmin = user.userType === "root" || user.userType === "admin" || user.userType === "operator"; // 运营
    var isBranchOffice = user.userType === "branchOffice"; // 分公司
    var searchConditionVar = {
      bussinessNo: "",
      customerName: "",
      qrcodeStatus: "",
      elecStatus: "",
      payStatus: ""
    };
    var detailsForm = { // 查看一级数据详情 数据解构
      customer: {},
      settleCard: {},
      product: {},
      imgs: {
        identityBackImg: {
          url: ""
        },

        identityFrontImg: {
          url: ""
        },
        identityHolderImg: {
          url: ""
        },
        bussinessLicenseImg: {
          url: ""
        },
        settleCardImg: {
          url: ""
        },
        accountLicenseImg: {
          url: ""
        },
        placeImg: {
          url: ""
        },
        storeImg: {
          url: ""
        },
        cashSpaceImg: {
          url: ""
        }
      }
    }
    // 聚合支付详情默认数据解构
    var payStatusDetails = {
      orgCode: "", //所在地
      bussinessAddress: "", //注册地址
      legalPerson: "", //法人
      idCard: "", //身份证号
      category: "", //行业类型
      // contactEmail: "", //邮箱
      accountType: "", //账户类型
      accountName: "", //账户名称
      bankName: "", //开户银行
      branchName: "", //开户支行
      accountNo: "", //账号
      wechatRate: "", //微信费率
      settleMode: "", //开通即刷即到
      t0CashCostFixed: "", //D0手续费
      identityFrontImg: "", //法人身份证正面
      identityBackImg: "", //法人身份证反面
      identityHolderImg: "", //手持身份证
      bussinessLicenseImg: "", //营业执照
      settleCardImg: "", //结算卡正面
      accountLicenseImg: "", //开户许可证
      placeImg: "", //门头照片
      storeImg: "", //店内照片
      cashSpaceImg: "" //收银台照片
    }
    var elecStatusDetails = { // 电子发票默认数据解构
      orgCode: "", //注册省份
      bussinessAddress: "", //注册地址
      bussinessPhone: "", //联系电话
      bussinessName: "", //经营名称
      registMoney: "", //注册资金
      branchName: "", //开户银行
      bankAccountNo: "", //银行账号
      elecBillnum: "", //月开票量
      elecReason: "" //被拒原因
    }
    var qrcodeImgs = { // 快速开票图片
      fastBussinessImg: {
        url: "",
      },
      fastCashImg: {
        url: "",
      },
      fastHeaderImg: {
        url: "",
      }
    }
    return {
      iscrollOptions: {
        scrollbars: true,
        mouseWheel: true,
        useTransform: true, //CSS转化
        useTransition: true //CSS过渡
      },
      styleForm: {
        supportTypes: [],
        // supportTypesArr: ["普票", "专票", "特殊"],
        payTypes: [],
        // payTypesArr: ["B扫C", "C扫B"]
      },
      supportTypesOptions: [
        {
          name: "普票",
          code: "1"
        },
        {
          name: "专票",
          code: "2"
        },
        {
          name: "特殊",
          code: "4"
        }
      ],
      payTypesOptions: [
        {
          name: "B扫C",
          code: "1"
        },
        {
          name: "C扫B",
          code: "2"
        }
      ],
      largeUrl: "",
      fadeViewVisible: false,
      styleVisible: false,
      // showImageVisible: true,
      largeImgUrl: "",
      qrcodelargeImgUrl: "",
      isAdmin: isAdmin,
      // 默认数据初始值
      detailsFormDefault: { ...detailsForm },
      resaultDataDefault: {},
      payStatusDetailsDefault: { ...payStatusDetails },
      elecStatusDetailsDefault: { ...elecStatusDetails },
      qrcodeImgsDefault: { ...qrcodeImgs },
      // 默认数据初始值 end
      detailsForm: detailsForm,
      resaultData: {},
      payStatusDetails: payStatusDetails,
      elecStatusDetails: elecStatusDetails,
      qrcodeImgs: qrcodeImgs,
      search: false,// 查询状态
      check: false,// 查询状态
      checkVisiblebut: false,
      editVisiblebut: false,
      closeVisible: false,
      rejectReason: "", //拒绝理由
      productOpenTitle: "完善信息",
      currentView: "openInfo",
      customerTypeSelected: [],
      optionsArea: regionData, //省市县插件
      sumLoading: false,
      payStatusVisible: false, // 聚合详情
      qrcodeStatusVisible: false, // 快速
      elecStatusVisible: false, // 电子
      selectOptions: {
        customerType: "payStatus",
        customerTypeOptions: [
          {
            value: "payStatus",
            label: "聚合支付",
            disabled: false
          },
          {
            value: "qrcodeStatus",
            label: "快速开票",
            disabled: false
          },
          {
            value: "elecStatus",
            label: "电子发票",
            disabled: false
          }
        ]
      },

      detailsFormVisible: false, // 详情框
      editFormVisible: false, // 编辑框
      formLabelWidth: "130px",
      payStatusFormRules: {}, // 编辑单个规则
      payStatusForm: {
        Area: [] // 必须为数组
      }, // 编辑单个表单
      // 聚合支付查询详情

      qrcodeStatusDetails: {}, // 快速开票查询详情
      resaultForm: {}, // 拒绝表单
      closeForm: {},
      closeFormRules: {
        reason: [
          { required: true, message: "请填写关闭原因", trigger: "blur,change" }
        ]
      },
      styleFormRules: {
        payTypes: [
          { required: true, message: "请选择支付类型", trigger: "blur" }
        ],
        supportTypes: [
          { required: true, message: "请选择开票类型", trigger: "blur" }
        ]
      },
      resaultFormRules: {
        reason: [{ required: true, message: "请填写拒绝理由", trigger: "blur,change" }]
      },


      // 查询条件数据
      searchCondition: searchConditionVar,
      // 顶部搜索表单信息
      searchOptions: [
        // 请注意 该数组里对象的corresattr属性值与searchCondition里面的属性是一一对应的 不可少
        {
          corresattr: "bussinessNo",
          type: "text", // 表单类型
          label: "商户编号", // 输入框前面的文字
          show: true, // 普通搜索显示
          value: "", // 表单默认的内容
          cb: value => {
            // 表单输入之后回调函数
            this.searchCondition.bussinessNo = value;
          }
        },
        {
          corresattr: "customerName",
          type: "text",
          label: "商户名称",
          show: true, // 普通搜索显示
          value: "",
          cb: value => {
            this.searchCondition.customerName = value;
          }
        },
        {
          corresattr: "payStatus",
          type: "select",
          label: "聚合支付",
          show: true, // 普通搜索显示
          value: "",
          options: [
            {
              value: "",
              label: "全部"
            },
            {
              label: "已开通",
              value: "TRUE"
            },
            {
              label: "未开通",
              value: "INIT"
            },
            {
              label: "拒绝",
              value: "REJECT"
            },
            {
              label: "待审核",
              value: "CHECKING"
            },
            {
              label: "待提交",
              value: "WAITING_SUBMIT"
            },
            {
              label: "已关闭",
              value: "FALSE"
            }
          ],
          cb: value => {
            this.searchCondition.payStatus = value;
          }
        },
        {
          corresattr: "qrcodeStatus",
          type: "select",
          label: "快速开票",
          show: false, // 普通搜索显示
          value: "",
          options: [
            {
              value: "",
              label: "全部"
            },
            {
              label: "已开通",
              value: "TRUE"
            },
            {
              label: "未开通",
              value: "INIT"
            },
            {
              label: "拒绝",
              value: "REJECT"
            },
            {
              label: "待审核",
              value: "CHECKING"
            },
            {
              label: "待提交",
              value: "WAITING_SUBMIT"
            },
            {
              label: "已关闭",
              value: "FALSE"
            }
          ],
          cb: value => {
            this.searchCondition.qrcodeStatus = value;
          }
        },
        {
          corresattr: "elecStatus",
          type: "select",
          label: "电子发票",
          show: false, // 普通搜索显示
          value: "",
          options: [
            {
              value: "",
              label: "全部"
            },
            {
              label: "已开通",
              value: "TRUE"
            },
            {
              label: "未开通",
              value: "INIT"
            },
            {
              label: "拒绝",
              value: "REJECT"
            },
            {
              label: "待审核",
              value: "CHECKING"
            },
            {
              label: "待提交",
              value: "WAITING_SUBMIT"
            },
            {
              label: "已关闭",
              value: "FALSE"
            }
          ],
          cb: value => {
            this.searchCondition.elecStatus = value;
          }
        }
      ],

      // 列表数据
      postSearch: searchConditionVar,
      tableData: {
        getDataUrl: {
          url: getCustomerOpenProducts // 初始化数据
        },
        dataHeader: [
          // table列信息 key=>表头标题，word=>表内容信息
          {
            key: "商户编号",
            width: "",
            sortable: true,
            word: "bussinessNo"
          },
          {
            key: "商户名称",
            width: "",
            word: "customerName"
          },

          {
            key: "快速开票",
            width: "",
            word: "qrcodeStatus",
            status: true,
            type: data => {
              if (data == "TRUE") {
                return {
                  text: "已开通",
                  type: "success"
                };
              } else if (data == "FALSE") {
                return {
                  text: "已关闭",
                  type: "info"
                };
              } else if (data == "INIT") {
                return {
                  text: "未开通",
                  type: "info"
                };
              } else if (data == "REJECT") {
                return {
                  text: "拒绝",
                  type: "error"
                };
              } else if (data == "CHECKING") {
                return {
                  text: "待审核",
                  type: "warning"
                };
              } else if (data == "WAITING_SUBMIT") {
                return {
                  text: "待提交",
                  type: "warning"
                };
              } else {
                return {
                  text: data,
                  type: "info"
                };
              }
            }
          },
          {
            key: "聚合支付",
            width: "",
            word: "payStatus",
            status: true,
            type: data => {
              if (data == "TRUE") {
                return {
                  text: "已开通",
                  type: "success"
                };
              } else if (data == "INIT") {
                return {
                  text: "未开通",
                  type: "info"
                };
              } else if (data == "FALSE") {
                return {
                  text: "已关闭",
                  type: "info"
                };
              } else if (data == "REJECT") {
                return {
                  text: "拒绝",
                  type: "error"
                };
              } else if (data == "CHECKING") {
                return {
                  text: "待审核",
                  type: "warning"
                };
              } else if (data == "WAITING_SUBMIT") {
                return {
                  text: "待提交",
                  type: "warning"
                };
              } else {
                return {
                  text: data,
                  type: "info"
                };
              }
            }
          },
          {
            key: "电子发票",
            width: "",
            word: "elecStatus",
            status: true,
            type: data => {
              if (data == "TRUE") {
                return {
                  text: "已开通",
                  type: "success"
                };
              } else if (data == "FALSE") {
                return {
                  text: "已关闭",
                  type: "info"
                };
              } else if (data == "INIT") {
                return {
                  text: "未开通",
                  type: "info"
                };
              } else if (data == "REJECT") {
                return {
                  text: "拒绝",
                  type: "error"
                };
              } else if (data == "CHECKING") {
                return {
                  text: "待审核",
                  type: "warning"
                };
              } else if (data == "WAITING_SUBMIT") {
                return {
                  text: "待提交",
                  type: "warning"
                };
              } else {
                return {
                  text: data,
                  type: "info"
                };
              }
            }
          }
        ],
        operation: {
          width: "200px",
          options: [
            {
              text: "开通",
              color: "#00c1df",
              visibleFn: rowdata => {
                if (
                  isAdmin || !isBranchOffice
                ) {
                  return true;
                } else {
                  return false;
                }
              },
              disabledFn: rowdata => {
                if (
                  rowdata.payStatus == "INIT" ||
                  rowdata.payStatus == "WAITING_SUBMIT" ||
                  rowdata.payStatus == "REJECT" ||
                  rowdata.payStatus == "FALSE" ||
                  rowdata.qrcodeStatus == "INIT" ||
                  rowdata.qrcodeStatus == "FALSE" ||
                  rowdata.elecStatus == "INIT" ||
                  rowdata.elecStatus == "REJECT" ||
                  rowdata.elecStatus == "FALSE"
                ) {
                  return false;
                } else {
                  return true;
                }
              },
              cb: rowdata => {
                this.resaultData = rowdata;
                // this.getCustomerEcho(); // 聚合支付回显
                // this.getElectronicEcho(); // 电子发票回显
                this.openProduct('payStatus');
              }
            },
            // 操作按钮
            {
              text: "查询",
              color: "#00c1df",
              cb: rowdata => {
                this.deFaultData();
                this.resaultData = rowdata;
                this.search = true;
                this.check = false;
                this.changeVisibleFn();
                this.getCustomerEcho(); // 聚合支付回显
                this.getElectronicEcho(); // 电子发票回显
                this.detailsForm = Object.assign(this.detailsForm, rowdata);
                // 所有选项均可选
                this.selectOptions.customerTypeOptions.forEach(element => {
                  element.disabled = false;
                });
                this.detailsFormVisible = true;
                this.resetScrollViewHeight();
              }
            },
            {
              text: "审核",
              visibleFn: rowdata => {
                if (
                  isAdmin &&
                  (
                    rowdata.elecStatus == "CHECKING")
                ) {
                  return true;
                } else {
                  return false;
                }
              },
              color: "#00c1df",
              cb: rowdata => {
                this.deFaultData();
                this.resaultData = rowdata;
                this.search = false;
                this.check = true;
                this.changeVisibleFn();
                this.getCustomerEcho(); // 聚合支付回显
                this.getElectronicEcho(); // 电子发票回显
                this.detailsForm = Object.assign(this.detailsForm, rowdata);
                // 只有电子发票可以审核
                this.selectOptions.customerTypeOptions.forEach(element => {
                  if (element.value != "elecStatus") {
                    element.disabled = true;
                    this.selectOptions.customerType = "elecStatus";
                  }
                });
                this.detailsFormVisible = true;
              }
            },
            // 一下按钮均为运营可操作
            {
              text: "关闭",
              visibleFn: rowdata => {
                if (
                  isAdmin &&
                  (
                    // rowdata.payStatus == "TRUE" ||
                    // rowdata.qrcodeStatus == "TRUE" ||
                    rowdata.elecStatus == "TRUE")
                ) {
                  return true;
                } else {
                  return false;
                }
              },
              color: "#00c1df",
              cb: rowdata => {
                this.resaultForm = rowdata;
                // 只有电子发票可以关闭
                this.selectOptions.customerTypeOptions.forEach(element => {
                  if (element.value != "elecStatus") {
                    element.disabled = true;
                    this.selectOptions.customerType = "elecStatus"
                  }
                });
                this.closeVisible = true;
              }
            },
            {
              text: "排版",
              color: "#00c1df",
              cb: rowdata => {
                this.resaultData = rowdata;
                let payType = rowdata.payType;
                let invoiceType = rowdata.invoiceType;
                this.styleForm.payTypes = [payType];
                this.styleForm.supportTypes = [invoiceType];
                switch (payType) {
                  case 0:
                    this.styleForm.payTypes = [];
                    break
                  case 1:
                    this.styleForm.payTypes = ["1"];
                    break
                  case 2:
                    this.styleForm.payTypes = ["2"];
                    break
                  case 3:
                    this.styleForm.payTypes = ["1", "2"];
                    break
                }
                switch (invoiceType) {
                  case 0:
                    this.styleForm.supportTypes = [];
                    break
                  case 1:
                    this.styleForm.supportTypes = ["1"];
                    break
                  case 2:
                    this.styleForm.supportTypes = ["2"];
                    break
                  case 4:
                    this.styleForm.supportTypes = ["4"];
                    break
                  case 3:
                    this.styleForm.supportTypes = ["1", "2"];
                    break
                  case 7:
                    this.styleForm.supportTypes = ["1", "2", "4"];
                    break
                  case 5:
                    this.styleForm.supportTypes = ["1", "4"];
                    break
                  case 6:
                    this.styleForm.supportTypes = ["2", "4"];
                    break
                }
                this.styleVisible = true;
              }
            }
          ]
        }
      }
    };
  },
  methods: {
    hideImageView() {
      this.fadeViewVisible = false
    },
    showImg(val, type) {
      if (type == 'pay') {
        this.largeImgUrl = val
      } else if (type == 'qrcode') {
        this.largeImgUrl = val
      }
      // this.fadeViewVisible = true
      // this.imageIndex = index
    },
    largeImageShow(url, type) {
      this.largeUrl = [url];
      this.fadeViewVisible = true
      this.imageIndex = 0
    },
    // 关闭，拒绝，通过
    resaultHandle(obj) {
      postHandleCustomerProduct()(obj).then(res => {
        if (res.code == "00") {
          this.closeVisible = false;
          this.detailsFormVisible = false;
          this.reloadData();
          this.$message({
            type: "success",
            message: "操作成功!"
          });
        } else {
          this.$message({
            type: "warning",
            message: res.msg
          });
        }
      });
    },
    // 关闭
    closeSave(formName) {
      // 编辑内容保存
      this.$refs[formName].validate(valid => {
        if (valid) {
          let resaultForm = this.resaultForm;
          let closeForm = this.closeForm;
          let customerType = this.selectOptions.customerType;
          let obj = {
            bussinessNo: resaultForm.bussinessNo,
            bussinessType: "customer"
          };
          let msg = "";
          if (customerType == "qrcodeStatus") {
            // 快速开票
            obj.qrReason = closeForm.reason;
            obj.qrcodeStatus = "FALSE";
            msg = "确定关闭快速开票业务业务并且将以短信形式通知商户?";
          } else if (customerType == "elecStatus") {
            obj.elecReason = closeForm.reason;
            obj.elecStatus = "FALSE";
            msg = "确定关闭电子发票业务并且将以短信形式通知商户?";
          } else if (customerType == "payStatus") {
            obj.payReason = closeForm.reason;
            obj.payStatus = "FALSE";
            msg = "确定关闭聚合业务并且将以短信形式通知商户?";
          }
          this.$confirm(msg, "提示", {
            confirmButtonText: "确定",
            cancelButtonText: "取消",
            type: "warning"
          }).then(() => {
            this.resaultHandle(obj);
          }).catch(() => {
          });;
        }
      });
    },
    // 审核通过
    adoptSave(customerType, detailsForm) {
      let resaultForm = this.resaultData;
      let obj = {
        bussinessNo: resaultForm.bussinessNo,
        bussinessType: "customer"
      };
      let msg = "";
      if (customerType == "qrcodeStatus") {
        obj.qrcodeStatus = "TRUE";
        msg = "确定通过 快速开票业务业务并且将以短信形式通知商户?";
      } else if (customerType == "elecStatus") {
        obj.elecStatus = "TRUE";
        msg = "确定通过 电子发票业务并且将以短信形式通知商户?";
      } else if (customerType == "payStatus") {
        obj.payStatus = "TRUE";
        msg = "确定通过 聚合业务并且将以短信形式通知商户?";
      }
      this.$confirm(msg, {
        confirmButtonText: "确定",
        cancelButtonText: "取消",
        type: "warning"
      }).then(() => {
        this.resaultHandle(obj);
      });
    },
    // 审核拒绝
    refuseSave(customerType, detailsForm) {
      this.$prompt("请输入拒绝原因", "提示", {
        confirmButtonText: "确定",
        cancelButtonText: "取消",
        inputPattern: /\S{1,}/,
        inputErrorMessage: "请输入拒绝原因"
      }).then(({ value }) => {
        let resaultForm = this.resaultData;
        let obj = {
          bussinessNo: resaultForm.bussinessNo,
          bussinessType: "customer"
        };
        let msg = "";
        if (customerType == "qrcodeStatus") {
          obj.qrReason = value;
          obj.qrcodeStatus = "REJECT";
          msg = "确定拒绝快速开票业务业务并且将以短信形式通知商户?";
        } else if (customerType == "elecStatus") {
          obj.elecReason = value;
          obj.elecStatus = "REJECT";
          msg = "确定拒绝电子发票业务并且将以短信形式通知商户?";
        } else if (customerType == "payStatus") {
          obj.payReason = value;
          obj.payStatus = "REJECT";
          msg = "确定拒绝聚合业务并且将以短信形式通知商户?";
        }
        this.$confirm(msg, {
          confirmButtonText: "确定",
          cancelButtonText: "取消",
          type: "warning"
        }).then(() => {
          this.resaultHandle(obj);
        });
      });
    },
    // 排版保存
    styleFormSave(formName) {
      this.$refs[formName].validate(valid => {
        if (valid) {
          let invoiceType = this.styleForm.supportTypes;//开票类型
          let payType = this.styleForm.payTypes; //支付类型
          let bussinessNo = this.resaultData.bussinessNo;
          getUserProductStatus()({
            bussinessNo: bussinessNo,
            bussinessType: "customer",
            invoiceTypes: invoiceType,
            payTypes: payType
          }).then(res => {
            if (res.code == "00") {
              this.$message({
                message: "操作成功！",
                type: "success",
                center: true
              });
              this.reloadData();
              this.styleVisible = false;
            } else {
              this.$message({
                message: res.msg,
                type: "warning",
                center: true
              });
            }
          })
        }
      })
    },
    // 点击开通产品
    openProduct(type) {
      let rowdata = { ...this.resaultData };
      this.customerTypeSelected = [
        {
          value: "payStatus",
          label: "聚合支付",
          disabled:
            rowdata.payStatus == "INIT" ||
              rowdata.payStatus == "REJECT" ||
              rowdata.payStatus == "WAITING_SUBMIT" ||
              rowdata.payStatus == "FALSE"
              ? false
              : true
        },
        {
          value: "qrcodeStatus",
          label: "快速开票",
          disabled:
            rowdata.qrcodeStatus == "INIT" ||
              rowdata.qrcodeStatus == "REJECT" ||
              rowdata.qrcodeStatus == "WAITING_SUBMIT" ||
              rowdata.qrcodeStatus == "FALSE"
              ? false
              : true
        },
        {
          value: "elecStatus",
          label: "电子发票",
          disabled:
            rowdata.elecStatus == "INIT" ||
              rowdata.elecStatus == "REJECT" ||
              rowdata.elecStatus == "WAITING_SUBMIT" ||
              rowdata.elecStatus == "FALSE"
              ? false
              : true
        }
      ];
      this.resaultData = { ...rowdata };
      this.nextFn("openInfo");
      this.editFormVisible = true;
    },
    // 聚合支付回显
    getCustomerEcho() {
      let resaultData = this.resaultData;
      let dialogLoading = this.$loading({
        target: document
          .querySelector("#dialogLoding")
          .querySelector(".el-dialog")
      });
      getCustomerEchoProduct()({
        customerNo: resaultData.bussinessNo,
        featureType: "CONVERGE_PAY"
      }).then(res => {
        if (res.code == "00") {
          // 聚合支付查询详情
          let data = res.data;
          let customerRow = {};
          let settleCardRow = {};
          let productRow = {};
          let imgsRow = {};
          let qrcodeImgs = {};// 快速开票imgs
          if (data.customer) {
            customerRow = utils.pickObj(data.customer, [
              "orgCode", 'bussinessAddress', 'legalPerson', 'idCard', 'category',
              'taxNo', 'enterpriseName', 'bussinessLicenseEffectiveBegin', 'bussinessLicenseEffectiveEnd'
            ]);
          }
          if (data.settleCard) {
            settleCardRow = utils.pickObj(data.settleCard, [
              "accountType", 'accountName', 'bankName', 'branchName', 'accountNo',
            ]);
          }
          if (data.product) {
            productRow = utils.pickObj(data.product, [
              "wechatRate", 'alipayRate', 'settleMode', 't0CashCostFixed',
            ]);
          }

          if (data.imgs) {
            imgsRow = utils.pickObj(data.imgs, [
              "identityFrontImg", "identityBackImg", "identityHolderImg", "bussinessLicenseImg", "settleCardImg",
              "accountLicenseImg", "placeImg", "storeImg", "cashSpaceImg"
            ]);
            // 快速开票图片回显
            qrcodeImgs = utils.pickObj(data.imgs, [
              "fastBussinessImg", "fastCashImg", "fastHeaderImg"
            ]);
          }

          this.qrcodeImgs = { ...this.qrcodeImgs, ...qrcodeImgs };
          this.payStatusDetails = {
            ...this.payStatusDetails,
            ...customerRow,
            ...settleCardRow,
            ...productRow,
            ...imgsRow
          }
          for (var i in imgsRow) {
            if (imgsRow[i].url) {
              this.largeImgUrl = imgsRow[i].url
              break;
            }
          }
          for (var i in qrcodeImgs) {
            if (qrcodeImgs[i].url) {
              this.qrcodelargeImgUrl = qrcodeImgs[i].url
              break;
            }
          }
        }
        dialogLoading.close();
      });
    },
    // 电子发票回显示
    getElectronicEcho() {
      let resaultData = this.resaultData;
      let dialogLoading = this.$loading({
        target: document
          .querySelector("#dialogLoding")
          .querySelector(".el-dialog")
      });
      getQueryCustomerElectronic()({
        customerNo: resaultData.bussinessNo,
        featureType: "ELECTRONIC"
      }).then(res => {
        if (res.code == "00") {
          let data = res.data;
          let customerRow = {};
          let customerInvoiceConfigRow = {};
          let productRow = {};
          if (data.customer) {
            customerRow = utils.pickObj(data.customer, [
              "orgCode", 'bussinessAddress', 'bussinessPhone', 'bussinessName', 'registMoney'
            ]);
          }
          if (data.customerInvoiceConfig) {
            customerInvoiceConfigRow = utils.pickObj(data.customerInvoiceConfig, [
              'branchName', 'bankAccountNo'
            ]);
          }
          if (data.product) {
            productRow = utils.pickObj(data.product, ['elecBillnum', 'elecReason']);
          }
          this.elecStatusDetails = { ...this.elecStatusDetails, ...customerRow, ...customerInvoiceConfigRow, ...productRow }
        }
        dialogLoading.close();
      });
    },

    editFn() {
      let customerType = this.selectOptions.customerType;
      if (customerType == "qrcodeStatus") {
      } else if (customerType == "elecStatus") {
        this.editFormVisible = true;
        this.openProduct('elecStatus');
      } else if (customerType == "payStatus") {
        this.editFormVisible = true;
        this.openProduct('payStatus');
      }
      this.detailsFormVisible = false
    },
    // 下一步
    nextFn(next) {
      this.currentView = next;
      this.reloadData()
    },
    // 返回
    backFn(path) {
      if (path == "close") {
        this.editFormVisible = false;
        this.currentView = "";
      } else if (path == "reload") {
        this.editFormVisible = false;
        this.currentView = "";
        // this.reloadData();
      } else {
        this.currentView = path;
      }
      this.reloadData()
    },
    titleChange(currentView) {
      if (currentView == "paystatusInfo") {
        this.productOpenTitle = "完善信息";
      } else if (currentView == "paystatusGoods") {
        this.productOpenTitle = "开通产品";
      } else if (currentView == "paystatusUpload") {
        this.productOpenTitle = "上传资质";
      } else if (currentView == "paystatusSuccess") {
        this.productOpenTitle = "申请完成";
      } else if (currentView == "elecstatusInfo") {
        this.productOpenTitle = "电子发票开通";
      } else if (currentView == "qrcodeInfo") {
        this.productOpenTitle = "快速开票";
      } else {
        this.productOpenTitle = currentView;
      }
    },
    // 编辑与审核按钮的显示隐藏
    changeVisibleFn() {
      let row = this.resaultData;
      let type = this.selectOptions.customerType;
      this.payStatusVisible = false;
      this.qrcodeStatusVisible = false;
      this.elecStatusVisible = false;
      this.checkVisiblebut = false;
      this.editVisiblebut = false;
      if (this.check) {
        switch (type) {
          case "qrcodeStatus":
            this.qrcodeStatusVisible = true;
            break;
          case "elecStatus":
            this.elecStatusVisible = true;
            if (row.elecStatus == "CHECKING" || row.elecStatus == "PROCESSING") {
              this.checkVisiblebut = true;
            }
            break;
          case "payStatus":
            this.payStatusVisible = true;
            if (row.payStatus == "CHECKING" || row.payStatus == "PROCESSING") {
              this.checkVisiblebut = true;
            }
            break;
        }
      }
      if (this.search) {
        switch (type) {
          case "qrcodeStatus":
            this.qrcodeStatusVisible = true;
            break;
          case "elecStatus":
            this.elecStatusVisible = true;
            if (row.elecStatus == "REJECT" || row.elecStatus == "WAITING_SUBMIT" && (this.isAdmin || !isBranchOffice)) {
              this.editVisiblebut = true;
            }
            break;
          case "payStatus":
            this.payStatusVisible = true;
            if (row.payStatus == "REJECT" || row.payStatus == "WAITING_SUBMIT" && (this.isAdmin || !isBranchOffice)) {
              this.editVisiblebut = true;
            }
            break;
        }
      }

    },
    deFaultData() {
      // 恢复默认数据
      this.resaultData = this.resaultDataDefault;
      this.detailsForm = this.detailsFormDefault;
      this.payStatusDetails = this.payStatusDetailsDefault;
      this.elecStatusDetails = this.elecStatusDetailsDefault;
      this.qrcodeImgs = this.qrcodeImgsDefault;
      this.largeImgUrl = "";
      this.qrcodelargeImgUrl = "";
    },
    specialCheck(value) {
      var have = this.styleForm.supportTypes.indexOf("普票");
      if (value) {
        if (have == "-1") {
          this.styleForm.supportTypes.push("普票");
        }
      } else {
        this.styleForm.supportTypes.pop();
      }
    },
    nomalCheck(value) {
      if (!value) {
        var have = this.styleForm.supportTypes.indexOf("特殊");
        if (have != "-1") {
          this.styleForm.supportTypes.push("普票");
        }
      }
    },
    preFn() {
      this.$refs.scrollPane.preFn(90)
    },
    preNext() {
      this.$refs.scrollPane.preNext(90)
    },
    resetScrollViewHeight() {
      this.$nextTick(() => {
        this.$refs.iscroll.refresh();
      })
    }
  },
  computed: {
    customerType() {
      return this.selectOptions.customerType
    },
    supportTypes() {
      return this.styleForm.supportTypes;
    }
  },
  watch: {
    customerType(val) {
      // this.deFaultData();
      this.payStatusVisible = false;
      this.qrcodeStatusVisible = false;
      this.elecStatusVisible = false;
      if (val == "qrcodeStatus") {
        this.qrcodeStatusVisible = true;
        this.$nextTick(() => {
          this.$refs.scrollPane.scrollPaneInit()
        })
      } else if (val == "elecStatus") {
        this.elecStatusVisible = true;
      } else if (val == "payStatus") {
        this.payStatusVisible = true;
        this.$nextTick(() => {
          this.$refs.scrollPane.scrollPaneInit()
        })
      }
      this.changeVisibleFn();
      this.$nextTick(() => {
        this.resetScrollViewHeight();
      })
    },
    // detailsFormVisible(val) {
    //   if (!val) {
    //     this.deFaultData();
    //   }
    // },
    editFormVisible(val) {
      if (!val) {
        this.currentView = "";
      }
    },
    supportTypes(value) {
      // 选择特殊的时候必须勾选普票
      if (new Set(value).has("4")) {
        let newCheck = Array.from(new Set(value).add("1"));
        this.styleForm.supportTypes = Object.assign(
          this.styleForm.supportTypes,
          newCheck
        );
      }
    }
  },
};
</script>

